angular.module("project",[]).controller("AppController",function(e){$.fn.serializeObject=function(){var e={},o=this.serializeArray();return $.each(o,function(){e[this.name]?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):e[this.name]=this.value||""}),e},e.salvarClick=function(){var o=JSON.stringify($("form").serializeObject());e.insertItemDB(o)},e.saveFile=function(e,o,n){function t(o){o.root.getFile(e,{create:!0},a,r)}function a(e){e.createWriter(i,r)}function i(e){e.onwriteend=function(o){console.log("finished writing"),void 0!==n&&n(e)},e.write(o)}function r(e){console.log("Error: ",e.code)}var c="export-file.txt";(void 0===e||null===e)&&(e=c),window.requestFileSystem(LocalFileSystem.PERSISTENT,0,t,r)},e.convertToCSV=function(e){var o="object"!=typeof e?JSON.parse(e):e,n="sep=,\r\n",t="",a=o[0];for(var i in o[0]){var r=i+"";t+='"'+r.replace(/"/g,'""')+'",'}t=t.slice(0,-1),n+=t+"\r\n";for(var c=0;c<o.length;c++){var t="";for(var i in o[c]){var r=o[c][i]+"";t+='"'+r.replace(/"/g,'""')+'",'}t=t.slice(0,-1),n+=t+"\r\n"}return n},e.insertItemDB=function(e){function o(o){o.executeSql("CREATE TABLE IF NOT EXISTS DADOS (id, data)"),o.executeSql("INSERT INTO DADOS (id, data) VALUES (1,'"+e+"')")}function n(e){console.log(e)}function t(){console.log("Gravado no Banco!")}var a=window.openDatabase("questionario","1.0","Questionario DB",1e6);a.transaction(o,n,t)},e.getItensFromDB=function(){function o(e){e.executeSql("SELECT * FROM DADOS",[],t,n)}function n(e){console.log(e)}function t(o,n){e.dataExport=[];var t=n.rows.length;console.log("DADOS table: "+t+" rows found.");for(var a=0;t>a;a++)e.dataExport.push(JSON.parse(n.rows.item(a).data));var i=e.convertToCSV(e.dataExport);navigator.userAgent.match(/(iPhone|iPod|iPad|Android|BlackBerry|IEMobile)/)?e.saveFile("export.csv",i):window.open("data:text/csv;charset=utf-8,"+escape(i)),alert("Arquivo Exportado")}var a=window.openDatabase("questionario","1.0","Questionario DB",1e6);a.transaction(o,n)},e.clearDB=function(){function e(e){e.executeSql("DROP TABLE IF EXISTS DADOS"),e.executeSql("CREATE TABLE IF NOT EXISTS DADOS (id, data)")}function o(e){console.log(e)}function n(){console.log("Dados Excluidos!")}var t=window.openDatabase("questionario","1.0","Questionario DB",1e6);t.transaction(e,o,n)}});