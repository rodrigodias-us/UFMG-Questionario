angular.module("project",[]).controller("AppController",function(e){e.pre_form_1="0",e.pre_form_2="0",e.pre_form_3="0",e.pre_form_4="0",e.has_children="0",e.numero="",$.fn.serializeObject=function(){var e={},o=this.serializeArray();return $.each(o,function(){e[this.name]?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):e[this.name]=this.value||""}),e},e.salvarClick=function(){var o=JSON.stringify($("form").serializeObject());e.insertItemDB(o)},e.saveFile=function(e,o,r){function n(o){o.root.getFile(e,{create:!0},t,i)}function t(e){e.createWriter(a,i)}function a(e){e.onwriteend=function(o){alert("Arquivo Salvo com Sucesso!"),void 0!==r&&r(e)},e.write(o)}function i(e){console.log("Error: ",e.code)}var c="export-file.txt";(void 0===e||null===e)&&(e=c),window.requestFileSystem(LocalFileSystem.PERSISTENT,0,n,i)},e.convertToCSV=function(e){var o="object"!=typeof e?JSON.parse(e):e,r="sep=,\r\n",n="",t=o[0];for(var a in o[0]){var i=a+"";n+='"'+i.replace(/"/g,'""')+'",'}n=n.slice(0,-1),r+=n+"\r\n";for(var c=0;c<o.length;c++){var n="";for(var a in o[c]){var i=o[c][a]+"";n+='"'+i.replace(/"/g,'""')+'",'}n=n.slice(0,-1),r+=n+"\r\n"}return r},e.insertItemDB=function(e){function o(o){o.executeSql("CREATE TABLE IF NOT EXISTS DADOS (id, data)"),o.executeSql("INSERT INTO DADOS (id, data) VALUES (1,'"+e+"')")}function r(e){console.log(e)}function n(){alert("Gravado no Banco!"),$("form")[0].reset(),$("html, body").scrollTop(0)}var t=window.openDatabase("questionario","1.0","Questionario DB",1e6);t.transaction(o,r,n)},e.getItensFromDB=function(){function o(e){e.executeSql("SELECT * FROM DADOS",[],n,r)}function r(e){console.log(e)}function n(o,r){e.dataExport=[];var n=r.rows.length;console.log("DADOS table: "+n+" rows found.");for(var t=0;n>t;t++)e.dataExport.push(JSON.parse(r.rows.item(t).data));var a=e.convertToCSV(e.dataExport);window.open("data:text/csv;charset=utf-8,"+escape(a)),alert("Arquivo Exportado")}var t=window.openDatabase("questionario","1.0","Questionario DB",1e6);t.transaction(o,r)},e.clearDB=function(){function e(e){e.executeSql("DROP TABLE IF EXISTS DADOS"),e.executeSql("CREATE TABLE IF NOT EXISTS DADOS (id, data)")}function o(e){console.log(e)}function r(){alert("Dados Excluidos!")}var n=window.openDatabase("questionario","1.0","Questionario DB",1e6);confirm("Tem certeza que deseja apagar todos os dados?")&&n.transaction(e,o,r)},e.changeNumber=function(){e.pre_num=e.pre_form_1+e.pre_form_2+e.pre_form_3+e.pre_form_4+e.has_children,e.numero_full=e.pre_num+e.numero,$("#numero").val("["+e.numero_full+"]")},e.changeNumber()});